{"version":3,"file":"admin.common.js","sources":["../../src/admin/utility/IPAddress.js","../../src/admin/common.js"],"sourcesContent":["(() => {\n    const loadClientInformation = async () => {\n        const CACHE_KEY = 'formychat_ip_data';\n        const DAY = 24 * 60 * 60 * 1000;\n\n        const emitLoaded = (data) => {\n            delete data.success;\n            window.formychat_ip = data;\n            window.dispatchEvent(new CustomEvent('formychat_ip_loaded', {\n                detail: data // The API response is directly passed as detail\n            }));\n        };\n\n        try {\n            // Check cache\n            const cached = localStorage.getItem(CACHE_KEY);\n            if (cached) {\n                const { timestamp, data } = JSON.parse(cached);\n                if (Date.now() - timestamp < DAY) {\n                    emitLoaded(data);\n                    return data;\n                }\n            }\n\n            // Fetch new\n            const res = await fetch(\"https://ipwhois.app/json/\");\n            if (!res.ok) throw new Error('Failed to fetch IP data');\n\n            const data = await res.json();\n            if (!data || typeof data !== 'object') throw new Error('Invalid IP data');\n\n            localStorage.setItem(CACHE_KEY, JSON.stringify({\n                timestamp: Date.now(),\n                data\n            }));\n\n            emitLoaded(data);\n            return data;\n\n        } catch (error) {\n            window.formychat_ip = null;\n            return null;\n        }\n    }\n\n    document.addEventListener('DOMContentLoaded', loadClientInformation);\n\n    window.addEventListener('formychat_ip_loaded', (e) => {\n        window.formychat_country_code = e.detail?.country_phone?.replace('+', '') || '44'\n    });\n})()","import './utility/IPAddress'\n\n(() => {\n    const target = document.querySelector('.formychat-dropdown')\n\n    if (!target) return\n\n    const placeholder = target.querySelector('.formychat-dropdown-placeholder')\n    const search = target.querySelector('.formychat-dropdown-content-search')\n    const input = target.querySelector('.formychat-dropdown-input')\n\n    const registerEvents = () => {\n\n        // On Click \n        document.addEventListener('click', (e) => {\n            if (!e.target.closest('.formychat-dropdown')) {\n                return close()\n            }\n\n            // on clicked placeholder.\n            if (e.target.closest('.formychat-dropdown-placeholder')) {\n                return toggle(e)\n            }\n\n            // on clicked item\n            if (e.target.closest('.formychat-dropdown-content-item') || e.target.classList.contains('formychat-dropdown-content-item')) {\n                return choose(e)\n            }\n        })\n        // Keypress.\n        document.addEventListener('keyup', (e) => {\n            // Ba if target not match the dropdown, return.\n            if (!e.target.closest('.formychat-dropdown')) return\n\n            // On search input\n            if (e.target.closest('.formychat-dropdown-content-search')) {\n                // console.log('search', e.target.value.toLowerCase().trim());\n                update(e.target.value.toLowerCase().trim())\n                return\n            }\n\n            // ESC key\n            if (e.key === 'Escape') {\n                close()\n                return\n            }\n        })\n\n        // Choose default item.\n        const defaultItem = target.querySelector('.formychat-dropdown-content-item.selected')\n        if (defaultItem) {\n            choose({ target: defaultItem })\n        }\n\n        // formychat_ip_loaded.\n        window.addEventListener('formychat_ip_loaded', (e) => {\n            console.log('formychat_ip_loaded', e.detail);\n        })\n\n    }\n\n    window.addEventListener('DOMContentLoaded', registerEvents)\n\n    // toggle the dropdown.\n    const toggle = (e) => {\n        e.preventDefault()\n        if (target.classList.contains('open')) {\n            return close()\n        }\n        open()\n    }\n\n    // Open the dropdown.\n    const open = () => {\n        target.classList.add('active')\n\n        // Focus on search input.\n        search.focus()\n\n        // Scroll to selected item.\n        const selected = target.querySelector('.formychat-dropdown-content-item.selected')\n        if (selected) {\n            selected.scrollIntoView({ behavior: 'smooth', block: 'center' })\n        }\n    }\n\n    // Close the dropdown.\n    const close = () => {\n        target.classList.remove('active')\n    }\n\n    // Choose the item.\n    const choose = (e) => {\n        // Unselect all items\n        const items = target.querySelectorAll('.formychat-dropdown-content-item')\n        items.forEach(i => {\n            i.classList.remove('selected')\n        })\n\n        // Select clicked item\n        e.target.classList.add('selected')\n\n        // Update placeholder\n        if (placeholder) {\n            placeholder.querySelector('span').textContent = e.target.dataset.placeholder\n        }\n\n        // Update hidden input value\n        input.value = e.target.dataset.value\n\n        // Reset search.\n        search.value = ''\n        update()\n        close()\n    }\n\n    // Update the items.\n    const update = (s = '') => {\n        const items = target.querySelectorAll('.formychat-dropdown-content-item')\n        items.forEach(i => {\n\n            let display = !s || s.length === 0\n\n            if (s && s.length) {\n                display = s.length === 0 || i.dataset.tags.toLowerCase().includes(s)\n            }\n\n            i.style.display = display ? 'block' : 'none'\n        })\n    }\n\n    // If the value is empty, set window.formychat_country_code.\n    if (!input.value || input.value.length === 0) {\n        // Wait for country code to be available\n        if (window.formychat_country_code) {\n            // Find item with matching country code\n            const items = target.querySelectorAll('.formychat-dropdown-content-item');\n            const defaultItem = Array.from(items).find(item =>\n                item.dataset.value === window.formychat_country_code\n            );\n\n            // If found matching item, select it\n            if (defaultItem) {\n                choose({ target: defaultItem });\n            }\n        } else {\n            // Listen for country code event if not yet available\n            window.addEventListener('formychat_ip_loaded', (e) => {\n                const countryCode = e.detail?.country_phone?.replace('+', '') || '44';\n                const items = target.querySelectorAll('.formychat-dropdown-content-item');\n                const defaultItem = Array.from(items).find(item =>\n                    item.dataset.value === countryCode\n                );\n\n                if (defaultItem) {\n                    choose({ target: defaultItem });\n                }\n            });\n        }\n    }\n\n})()\n"],"names":["loadClientInformation","CACHE_KEY","emitLoaded","data","cached","timestamp","res","e","_b","_a","target","placeholder","search","input","registerEvents","close","toggle","choose","update","defaultItem","open","selected","i","s","display","items","item","countryCode"],"mappings":"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"}